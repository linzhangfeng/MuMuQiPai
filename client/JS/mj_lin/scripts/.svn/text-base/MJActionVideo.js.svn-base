var MJActionVideo = cc.Layer.extend({
    opBtns: [[] , [] , [] , []],
    actions: [{} , {} , {} , {}],
    ctor: function () {
        this._super();

        for(var i = 0 ; i < 4 ; i++){
            var btn = new ccui.Button();
            btn.loadTextures(getResPath("RoomMJ/action/pass1.png"), getResPath("RoomMJ/action/pass2.png"), "");
            btn.setName("pass");
            btn.setVisible(false);
            btn.setTag(5);
            this.addChild(btn);

            this.actions[i]["pass"] = btn;
            this.opBtns[i].push(btn);
        }

        for(var i = 0 ; i < 4 ; i++){
            var btn = new ccui.Button();
            btn.loadTextures(getResPath("RoomMJ/action/hu1.png"), getResPath("RoomMJ/action/hu2.png"), "");
            btn.setName("hu");
            btn.setVisible(false);
            btn.setTag(1);
            this.addChild(btn);

            this.actions[i]["hu"] = btn;
            this.opBtns[i].push(btn);
        }

        for(var i = 0 ; i < 4 ; i++){
            var btn = new ccui.Button();
            btn.loadTextures(getResPath("RoomMJ/action/gang1.png"), getResPath("RoomMJ/action/gang2.png"), "");
            btn.setName("gang");
            btn.setVisible(false);
            btn.setTag(2);
            this.addChild(btn);

            this.actions[i]["gang"] = btn;
            this.opBtns[i].push(btn);
        }

        for(var i = 0 ; i < 4 ; i++){
            var btn = new ccui.Button();
            btn.loadTextures(getResPath("RoomMJ/action/peng1.png"), getResPath("RoomMJ/action/peng2.png"), "");
            btn.setName("peng");
            btn.setVisible(false);
            btn.setTag(3);
            this.addChild(btn);

            this.actions[i]["peng"] = btn;
            this.opBtns[i].push(btn);
        }

        for(var i = 0 ; i < 4 ; i++){
            var btn = new ccui.Button();
            btn.loadTextures(getResPath("RoomMJ/action/chi1.png"), getResPath("RoomMJ/action/chi2.png"), "");
            btn.setName("chi");
            btn.setVisible(false);
            btn.setTag(4);
            this.addChild(btn);

            this.actions[i]["chi"] = btn;
            this.opBtns[i].push(btn);
        }

    },

    setOperator: function (pos , operat) {
        for (var i = 0; i < this.opBtns[pos].length; i++) {
            this.opBtns[pos][i].setVisible(false);
        }

        if (operat == -1 || operat == 0 || operat == null || operat == undefined) {
            return false;
        }

        if (( operat & ActionType.TYPE_LISTEN) == ActionType.TYPE_LISTEN) {
            operat = operat - ActionType.TYPE_LISTEN;
        }

        if(operat <= 0){
            return false;
        }

        if (this.actions[pos]["pass"]) {
            this.actions[pos]["pass"].setVisible(true);
        }

        if ((operat & ActionType.TYPE_HU) == ActionType.TYPE_HU) {
            if (this.actions[pos]["hu"]) {
                this.actions[pos]["hu"].setVisible(true);
            }
        }

        if ((operat & ActionType.TYPE_ZHIGANG) == ActionType.TYPE_ZHIGANG || (operat & ActionType.TYPE_WANGANG) == ActionType.TYPE_WANGANG || (operat & ActionType.TYPE_ANGANG) == ActionType.TYPE_ANGANG) {
            if (this.actions[pos]["gang"]) {
                this.actions[pos]["gang"].setVisible(true);
            }
        }

        if ((operat & ActionType.TYPE_PENG) == ActionType.TYPE_PENG) {
            if (this.actions[pos]["peng"]) {
                this.actions[pos]["peng"].setVisible(true);
            }
        }

        if ((operat & ActionType.TYPE_LEFT_CHI) == ActionType.TYPE_LEFT_CHI || (operat & ActionType.TYPE_CENTER_CHI) == ActionType.TYPE_CENTER_CHI || (operat & ActionType.TYPE_RIGHT_CHI) == ActionType.TYPE_RIGHT_CHI) {
            if (this.actions[pos]["chi"]) {
                this.actions[pos]["chi"].setVisible(true);
            }
        }

        this.reflashOpBtns(pos);
        return true;
    },

    reflashOpBtns: function (pos) {
        this.opBtns[pos].sort(function (a, b) {
            try {
                var aValue = a.getTag();
                var bValue = b.getTag();
                return bValue - aValue;
            } catch (e) {
                return 0;
            }
        });

        var size = cc.director.getWinSize();
        var bx = size.width - 276;
        var by = 200;
        var dx = 180;
        var index = 0;
        var scale = 1;
        var dy = 80;

        if(pos == 1){
            bx = size.width - 200;
            by = 620;
            scale = 0.5;
            dx = 90;
        }else if(pos == 2){
            bx = size.width - 400;
            by = 580;
            scale = 0.5;
            dx = 90;
        }else if(pos == 3){
            bx = size.width - 1080;
            by = 620;
            scale = 0.5;
            dx = 90;
        }

        for (var i = 0; i < this.opBtns[pos].length; i++) {
            var opBtn = this.opBtns[pos][i];
            if (opBtn.isVisible()) {
                if(pos == 0 || pos == 2){
                    opBtn.setPosition(cc.p(bx - dx * index, by));
                }else {
                    opBtn.setPosition(cc.p(bx, by - dy * index));
                }
                opBtn.setScale(scale);
                index++;
            }
        }
    },

    reset: function () {
        for(var i = 0 ; i < 4 ; i++){
            this.setOperator(i , -1);
        }
    },
});